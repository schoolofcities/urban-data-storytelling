<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Isabeaux Graham, Jeff Allen">

<title>Data visualization – Urban Data Storytelling 📊📈🏙️</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/favicon.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6fbcbd56e20030bb8c94bdea314e40aa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XB09CWTEWB"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-XB09CWTEWB');
</script>

<meta name="description" content="Notebooks on urban data analysis and visualization">
<meta name="author" content="School of Cities">

<meta property="og:title" content="Data visualization – Urban Data Storytelling 📊📈🏙️">
<meta name="og:description" content="Notebooks on urban data analysis and visualization">
<meta property="og:type" content="website">
<meta property="og:url" content="https://schoolofcities.github.io/urban-data-storytelling">
<meta property="og:image" content="https://raw.githubusercontent.com/schoolofcities/urban-data-storytelling/refs/heads/main/assets/web-card.png">
<meta property="og:locale" content="en_CA">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="https://schoolofcities.github.io/urban-data-storytelling">
<meta name="twitter:creator" content="@UofTCities">
<meta name="twitter:title" content="Data visualization – Urban Data Storytelling 📊📈🏙️">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://raw.githubusercontent.com/schoolofcities/urban-data-storytelling/refs/heads/main/assets/web-card.png">


<link rel="stylesheet" href="../../assets/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../urban-data-visualization/data-visualization/data-visualization.html">Urban Data Visualization</a></li><li class="breadcrumb-item"><a href="../../urban-data-visualization/data-visualization/data-visualization.html">Data visualization</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../"><img src="https://raw.githubusercontent.com/schoolofcities/gta-immigration/refs/heads/main/src/assets/top-logo-full.svg" style="height:auto;width:250px;margin-left: -20px;"><br>Urban Data Storytelling 📊📈🏙️</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Urban Data Storytelling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-storytelling/urban-data-storytelling-importance/urban-data-storytelling-importance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The importance of urban data storytelling</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Urban Data Analytics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/what-and-where-of-data/what-and-where-of-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to urban data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/measuring-the-city/measuring-the-city.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Measuring the city: metrics and indicators</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/data-ethics-and-literacy/data-ethics-and-literacy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data ethics and literacy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/intro-to-python-and-jupyter/intro-to-python-and-jupyter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming with Python and computational notebooks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/data-analytics-and-processing/data-analytics-and-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Processing and analyzing data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/statistical-foundations/statistical-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/spatial-data-and-gis/spatial-data-and-gis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial data and GIS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/spatial-data-in-python/spatial-data-in-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial data in Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/spatial-data-processing/spatial-data-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial data processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/canadian-census-data/canadian-census-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview of Canadian census data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-analytics/us-census-data/us-census-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview of U.S. census data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Urban Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-visualization/data-visualization/data-visualization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Data visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-visualization/exploratory-data-visualization/exploratory-data-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploratory data visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-visualization/maps-and-spatial-data-visualization/maps-and-spatial-data-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maps and visualizing spatial data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-visualization/choropleth-maps/choropleth-maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Choropleth maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-visualization/bivariate-choropleth-maps/bivariate-choropleth-maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bivariate choropleth maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-visualization/proportional-symbol-maps/proportional-symbol-maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Proportional symbol maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-visualization/flow-maps/flow-maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Flow maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../urban-data-visualization/categorical-dot-maps/categorical-random-dot-maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical dot maps</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#why-visualize-data" id="toc-why-visualize-data" class="nav-link active" data-scroll-target="#why-visualize-data">Why visualize data?</a></li>
  <li><a href="#data-visualization-for-exploratory-analysis" id="toc-data-visualization-for-exploratory-analysis" class="nav-link" data-scroll-target="#data-visualization-for-exploratory-analysis">Data visualization for exploratory analysis</a></li>
  <li><a href="#data-visualization-for-communication-and-storytelling" id="toc-data-visualization-for-communication-and-storytelling" class="nav-link" data-scroll-target="#data-visualization-for-communication-and-storytelling">Data visualization for communication and storytelling</a>
  <ul class="collapse">
  <li><a href="#designing-for-specific-audiences" id="toc-designing-for-specific-audiences" class="nav-link" data-scroll-target="#designing-for-specific-audiences">Designing for specific audiences</a></li>
  </ul></li>
  <li><a href="#data-visualization-theory" id="toc-data-visualization-theory" class="nav-link" data-scroll-target="#data-visualization-theory">Data visualization theory</a>
  <ul class="collapse">
  <li><a href="#visual-variables" id="toc-visual-variables" class="nav-link" data-scroll-target="#visual-variables">Visual variables</a></li>
  <li><a href="#perception-and-cognition" id="toc-perception-and-cognition" class="nav-link" data-scroll-target="#perception-and-cognition">Perception and cognition</a></li>
  <li><a href="#perceptual-rankings" id="toc-perceptual-rankings" class="nav-link" data-scroll-target="#perceptual-rankings">Perceptual Rankings</a></li>
  <li><a href="#visual-accessibility" id="toc-visual-accessibility" class="nav-link" data-scroll-target="#visual-accessibility">Visual accessibility</a></li>
  </ul></li>
  <li><a href="#chart-components" id="toc-chart-components" class="nav-link" data-scroll-target="#chart-components">Chart components</a></li>
  <li><a href="#practical-tips-for-effective-data-visualization" id="toc-practical-tips-for-effective-data-visualization" class="nav-link" data-scroll-target="#practical-tips-for-effective-data-visualization">Practical tips for effective data visualization</a>
  <ul class="collapse">
  <li><a href="#hierarchy-in-graphics-and-stories" id="toc-hierarchy-in-graphics-and-stories" class="nav-link" data-scroll-target="#hierarchy-in-graphics-and-stories">Hierarchy in graphics and stories</a></li>
  <li><a href="#de-clutter-and-high-data-ink-ratio" id="toc-de-clutter-and-high-data-ink-ratio" class="nav-link" data-scroll-target="#de-clutter-and-high-data-ink-ratio">De-clutter and high data-ink ratio</a></li>
  <li><a href="#design-for-your-output" id="toc-design-for-your-output" class="nav-link" data-scroll-target="#design-for-your-output">Design for your output</a></li>
  <li><a href="#brand-guidelines" id="toc-brand-guidelines" class="nav-link" data-scroll-target="#brand-guidelines">Brand guidelines</a></li>
  <li><a href="#annotations" id="toc-annotations" class="nav-link" data-scroll-target="#annotations">Annotations</a></li>
  <li><a href="#choosing-charts-based-on-your-data" id="toc-choosing-charts-based-on-your-data" class="nav-link" data-scroll-target="#choosing-charts-based-on-your-data">Choosing charts based on your data</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../urban-data-visualization/data-visualization/data-visualization.html">Urban Data Visualization</a></li><li class="breadcrumb-item"><a href="../../urban-data-visualization/data-visualization/data-visualization.html">Data visualization</a></li></ol></nav><h1 class="title display-7">Data visualization</h1></header>

<header id="title-block-header">

<p class="author">Isabeaux Graham, Jeff Allen</p>

</header>


<p>Data visualization is the graphical representation of information and data. By using visual elements like charts, graphs, and maps, data visualization tools help people understand patterns, trends, and outliers in data. At its core, data visualization translates abstract numbers into something visible and intuitive, helping our audiences better understand what the data is telling us.</p>
<p>We live in a world increasingly shaped by data – from climate change and public health to business performance and social media behavior – however, raw numbers alone are difficult to interpret. Visualizations help bridge that gap by making data more accessible, understandable, and actionable. It’s not just about making things look good, it’s about making data make sense.</p>
<p>“The simple graph has brought more information to the data analyst’s mind than any other device. It specializes in providing indications of unexpected phenomena.” – <a href="https://en.wikipedia.org/wiki/John_Tukey" target="_blank">John Tukey</a></p>
<section id="why-visualize-data" class="level2">
<h2 data-anchor-id="why-visualize-data">Why visualize data?</h2>
<p>We visualize data to help us understand it better. When we turn numbers into pictures like charts or graphs, it becomes easier to see patterns, trends, or problems. Broadly speaking, visualization can serve two major goals:</p>
<ol type="1">
<li><em>Exploration</em> – Using charts to help make sense of the data. It helps you find interesting things or answer questions</li>
<li><em>Communication</em> – Using visuals to help other people understand what you found in the data</li>
</ol>
<p>These goals are not mutually exclusive. The best data work is iterative. We often begin by visualizing data to explore patterns, test ideas, and uncover insights. Once we have made sense of the data ourselves, we can use visualizations to communicate key findings, tell a compelling story, or make a case for action. Whether the goal is understanding, persuasion, or advocacy, good data visualization helps bridge the gap between raw information and meaningful insight.</p>
<p>Visualizing data is ultimately about communication and striking the right balance between analysis, design, and narrative. To share data in a clear and meaningful way, it helps to think through this data storytelling framework:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/framework-diagram.png" class="img-fluid figure-img"></p>
<figcaption>Framework for data storytelling</figcaption>
</figure>
</div>
<ol type="1">
<li><p><em>Data Analysis</em>: What does the data tell us? What patterns or relationships matter?</p></li>
<li><p><em>Visualization</em>: How can this data be represented graphically to communicate findings effectively?</p></li>
<li><p><em>Narrative</em>: What story does the data tell? What’s your argument or takeaway? Who is your target audience?</p></li>
</ol>
<p>This framework helps situate visualization as part of a broader storytelling or decision-making process. Whether you are creating a data story with multiple visuals or a single chart for a report, it is important to keep all of these things in mind. The purpose behind your visualization determines everything from the chart type you use to the level of detail, annotation, and tone you adopt.</p>
</section>
<section id="data-visualization-for-exploratory-analysis" class="level2">
<h2 data-anchor-id="data-visualization-for-exploratory-analysis">Data visualization for exploratory analysis</h2>
<p>Before we share our findings with others, we often need to make sense of the data ourselves. This is where exploratory data analysis comes in. This is the process of visually investigating datasets to uncover trends, spot anomalies, test hypotheses, and surface insights that might otherwise be hidden in raw numbers or tables.</p>
<p>Visualization during this stage can reveal unexpected patterns and outliers, correlations and clusters, distribution shapes, and data quality issues.</p>
<p>It also helps uncover relationships that summary statistics alone might obscure. The exploratory process is typically iterative and often messy, with charts not needing to be beautiful, but instead, informative. Quick plots, heatmaps, and scatterplots are all useful tools in this phase, enabling a deeper understanding of the data before any formal analysis or presentation.</p>
<p>Even datasets with identical statistical properties can convey vastly different stories when visualized. A perfect example of this is <a href="https://en.wikipedia.org/wiki/Anscombe%27s_quartet" target="_blank">Anscombe’s Quartet</a>, a set of four datasets that have nearly identical means, variances, and correlation coefficients, yet their graphical representations reveal dramatic differences. This illustrates the importance of visualizing data, rather than solely relying on summary statistics, as the true patterns and relationships may be hidden within the numbers themselves.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/AnscombeQuartet.png" class="img-fluid figure-img"></p>
<figcaption>Ansecombe’s Quartet, for datasets with almost identical summary statistics, but widely different patterns when charted</figcaption>
</figure>
</div>
</section>
<section id="data-visualization-for-communication-and-storytelling" class="level2">
<h2 data-anchor-id="data-visualization-for-communication-and-storytelling">Data visualization for communication and storytelling</h2>
<p>Once we’ve explored the data and identified key findings, the next step is to share these insights with others. Data visualization becomes a powerful tool for communication, helping us inform, engage, and persuade different audiences. In this context, visualization is not just about showing data, it’s about <em>shaping understanding</em> and sometimes even <em>inspiring action</em>.</p>
<p>Data stories combine charts and text to walk the audience through a narrative arc. These stories often include:</p>
<ol type="1">
<li><em>Context</em> – What’s the issue or question?</li>
<li><em>Data</em> – What patterns or evidence are we seeing?</li>
<li><em>Insight</em> – Why does it matter?</li>
<li><em>Action</em> – What should happen next?</li>
</ol>
<p>Good data visualizations and stories often zoom in and out to show both the big picture and key details while guiding the audience with clear visual hierarchy and annotations.</p>
<p>In advocacy contexts, data visualizations are used to support arguments, influence policy, and raise awareness. The visual design here should support the clarity and urgency of the message while still being transparent and truthful.</p>
<section id="designing-for-specific-audiences" class="level3">
<h3 data-anchor-id="designing-for-specific-audiences">Designing for specific audiences</h3>
<p>Not all data visualizations are created for the same audience or communication goals. Some are meant to be read in detail (like charts in a policy report), while others are intended to create an emotional impact at a glance (like a billboard or social media graphic).</p>
<p>For example, a line chart depicting global temperatures over time provides nuance and precision, making it an excellent choice for scientists and analysts.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/GlobalTemp.png" class="img-fluid figure-img"></p>
<figcaption>Global Temperatures Over Time (Source: NASA/GISS)</figcaption>
</figure>
</div>
<p>Alternatively, <a href="https://en.wikipedia.org/wiki/Warming_stripes" target="_blank">warming stripes</a>, a minimalist visualization uses a simple color gradient to represent temperature changes. This approach communicates the same pattern but in a more striking and emotionally impactful way, making it highly effective for public engagement and advocacy.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/WarmingStripes.png" class="img-fluid figure-img"></p>
<figcaption>Warming strips</figcaption>
</figure>
</div>
</section>
</section>
<section id="data-visualization-theory" class="level2">
<h2 data-anchor-id="data-visualization-theory">Data visualization theory</h2>
<p>A well-designed visualization isn’t just about making data look good – it’s about making it understandable, accurate, and accessible. This often requires a base understanding of how we encode data visually, how the human brain processes that information, and how to make charts function well across different audiences and mediums.</p>
<section id="visual-variables" class="level3">
<h3 data-anchor-id="visual-variables">Visual variables</h3>
<p>At the heart of every chart or graph is visual encoding: the transformation of data into visual elements. Each variable in your dataset must be “mapped” to a visual channel, often called a <em>visual variable</em>. The effectiveness of these visual encodings depends on what type of data you’re working with.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/BertinVariables.png" class="img-fluid figure-img"></p>
<figcaption>Bertin’s Visual Variables via <a href="https://www.axismaps.com/guide/visual-variables" target="_blank">Axis Maps</a></figcaption>
</figure>
</div>
</section>
<section id="perception-and-cognition" class="level3">
<h3 data-anchor-id="perception-and-cognition">Perception and cognition</h3>
<p>Effective data visualization leverages our brain’s innate ability to rapidly process certain visual elements. This phenomenon, known as <em>preattentive processing</em>, allows viewers to quickly and effortlessly identify certain patterns, contrasts, and structures without conscious effort.</p>
<p>This allows us to instantly spot outliers, notice trends and clusters, and recognize visual hierarchies.</p>
<p>Key preattentive features include color, form, orientation, and size. For example, we can quickly distinguish a red circle among blue circles (color) and identify a square amidst a group of circles (form). These features are processed so swiftly and effortlessly that they can influence our perception and understanding of visual information without conscious effort.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/PreattentiveProcessing.png" class="img-fluid figure-img"></p>
<figcaption>Example of preattentive processing. Source: www.csc2.ncsu.edu/faculty/healey/PP/</figcaption>
</figure>
</div>
<p>Even when designing a table for a slide deck or a report, you can use the theory of preattentive processing to pick a visual variable to focus your readers attention on specific data points that are important to your story.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/PreattentiveProcessingTable.png" class="img-fluid figure-img"></p>
<figcaption>Example of preattentive processing to highlight rows in a table (Source: <a href="https://www.cnn.com/us/maps-damage-los-angeles-wildfires-dg/index.html" target="_blank">CNN</a>)</figcaption>
</figure>
</div>
<p>Via preattentive processing, we can guide viewers’ attention efficiently, enhance comprehension, and reduce cognitive load.</p>
</section>
<section id="perceptual-rankings" class="level3">
<h3 data-anchor-id="perceptual-rankings">Perceptual Rankings</h3>
<p><em>Perceptual Rankings</em> help explain why some encodings are easier to interpret than others. Not all visual variables are equally effective.</p>
<p>You may have noticed that in the scatter-plot example in the previous section, that it is generally easier to pick out a red circle among a group of blue circles rather than a blue square among a group of blue circles.</p>
<p>Research has established a hierarchy of visual channels based on their accuracy and ease of interpretation:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/PerceptualRankings.png" class="img-fluid figure-img"></p>
<figcaption>Perceptual Rankings (Source: Visualization Analysis and Design by Tamara Munzner)</figcaption>
</figure>
</div>
<p>Understanding these perceptual principles ensures that visualizations communicate information clearly and intuitively, aligning with how viewers naturally process visual stimuli.</p>
<p>For example, based on this research, position on a common scale is easier to interpret than size or area for quantitative data. Comparing volumes is also relatively difficult. This leads to two recommendations…</p>
<ul>
<li>Avoid pie charts (especially for more 3 categories) since they can be less effective than alternatives (e.g.&nbsp;bar charts)</li>
<li>Avoid 3D charts in most cases because they tend to over-complicate, be difficult to read, and add extra visual clutter compared to 2D alternatives</li>
</ul>
</section>
<section id="visual-accessibility" class="level3">
<h3 data-anchor-id="visual-accessibility">Visual accessibility</h3>
<p>Your data visualizations should be readable by everyone, which means thinking beyond aesthetics and into the realm of inclusive design.</p>
<p>For charts and maps, there are two main things to consider</p>
<ol type="1">
<li><p>Using colourblind safe colours. Tools, such as <a href="https://colorbrewer2.org" target="_blank">ColorBrewer</a> can be used to pick safe colours. There are also <a href="https://www.color-blindness.com/coblis-color-blindness-simulator/" target="_blank">tools for uploading images</a> (e.g.&nbsp;of a chart or a map), and test how it is viewed for different types of colourblindness. Highly recommend using this for any graphics that will appear in publications</p></li>
<li><p>Using adequate font sizes and making sure there is adequate level of contrast between foreground and background, especially with text. The greater the contrast between the foreground and background, the easier it is to read. For text, keep in mind that font size plays a significant role: smaller fonts require even higher contrast between the text color and background to maintain readability. There are online <a href="https://webaim.org/resources/contrastchecker/" target="_blank">tools for checking contrast ratios</a> between background and foreground that are useful for design.</p></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/VisualAccessibility.png" class="img-fluid figure-img"></p>
<figcaption>Examples of different text on a background at different contrast ratios</figcaption>
</figure>
</div>
</section>
</section>
<section id="chart-components" class="level2">
<h2 data-anchor-id="chart-components">Chart components</h2>
<p>Strong visualizations depend not just on the data and encodings, but on thoughtful framing. The supporting elements of a chart provide clarity and context.</p>
<p>Thinking about and directly designing each of the different components of a chart, rather than just using the defaults of a software (e.g.&nbsp;what a chart in <code>Excel</code> or a <code>Python</code> library will give you initially), will go a long way in making effective graphics. The graphic below shows the components commonly used when constructing a chart. Try to think about the design of each of these components in your own charts. If it doesn’t clarify the data and story, it probably distracts, and it’s probably best to either remove or de-emphasize it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/ChartComponents.png" class="img-fluid figure-img"></p>
<figcaption>Chart components (Source: data.europa.eu/apps/data-visualisation-guide)</figcaption>
</figure>
</div>
</section>
<section id="practical-tips-for-effective-data-visualization" class="level2">
<h2 data-anchor-id="practical-tips-for-effective-data-visualization">Practical tips for effective data visualization</h2>
<p>A strong visualization can make complex data accessible; however, without care, the message can get lost. Great visualizations balance clarity, precision, and aesthetics. This section offers practical tips and guiding principles to elevate your data visualizations.</p>
<p>Note that these are general recommendations and rules of thumb, not rules that you must follow 100% of the time! Data visualization is a combination of technical, design, and artistic skills, and there are often exceptions to the rules :)</p>
<section id="hierarchy-in-graphics-and-stories" class="level3">
<h3 data-anchor-id="hierarchy-in-graphics-and-stories">Hierarchy in graphics and stories</h3>
<p>Guide the viewer’s eye by creating a hierarchy between background and foreground. Your key message should be the focus and highlighted while everything else (axes, grid-lines, background elements) should support and not compete with it.</p>
<ul>
<li>Bold or highlight key data points.</li>
<li>Use size, contrast, and colour to signal importance.</li>
<li>De-emphasize secondary elements like gridlines, minor tick marks, or axis labels</li>
</ul>
<p>For example, the line chart in the image above has a strong visual hierarchy between the key data points it wants to show (e.g.&nbsp;the lines for Sweden, the E.U., and Ireland) relative to the rest of the chart components.</p>
<p>When guiding your readers through a story with a series of visualizations, sometimes it is useful to follow a Data Visualization Sandwich metaphor:</p>
<p><img src="img/Sandwich.png" class="img-fluid"></p>
<p>This is very similar to journalistic styles of writing, “don’t bury the lead” and “bottom line up-front”.</p>
<p>Let’s look at an example. This is a map of the United States from an article by the <a href="www.theguardian.com/environment/2022/feb/05/americans-above-average-temperature-increase-climate-crisis" target="_blank">Guardian</a> on how the USA is facing above average rises in temperatures. This map acts as the Patty – it draws the attention of the reader and introduces the topic of the article.</p>
<p><img src="img/Sandwich_EX1.png" class="img-fluid"></p>
<p>The article then takes a deeper look at specific counties that have experienced significant temperature increases via a table:</p>
<p><img src="img/Sandwich_EX2.png" class="img-fluid"></p>
<p>Finally, this visual, which could be considered a patty or bun, helps illustrate the temperatures across U.S. states. It also includes a “topping” – an annotation over California that highlights how the entire population has experienced a temperature increase since 1895.</p>
<p><img src="img/Sandwich_EX3.png" class="img-fluid"></p>
</section>
<section id="de-clutter-and-high-data-ink-ratio" class="level3">
<h3 data-anchor-id="de-clutter-and-high-data-ink-ratio">De-clutter and high data-ink ratio</h3>
<p>Coined by <a href="https://en.wikipedia.org/wiki/Edward_Tufte" target="_blank">Edward Tufte</a>, the data-ink ratio refers to the proportion of visual elements that represent actual data, rather than decoration, relative to all ‘ink’ on the chart.</p>
<p>In other words, this is about reducing clutter and focusing graphical elements of a chart on the data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/DataInkRatio.png" class="img-fluid figure-img"></p>
<figcaption>Left: Low data-ink ratio / Right: High data-ink ratio</figcaption>
</figure>
</div>
<p>Here are a few recommendations for reducing clutter and increasing data-ink ratios:</p>
<ul>
<li>Remove non-essential “chartjunk” (3D effects, background shading, unnecessary gridlines, borders).</li>
<li>Use direct labels instead of relying on legends.</li>
<li>Choose simple chart types unless complexity is truly needed.</li>
<li>Use subtle formatting of reference information like gridlines to keep the audience focused on the data itself.</li>
<li>Avoid overuse of colors, labels, and gridlines.</li>
<li>You don’t need to visualize every possible variable or data point, focus on the story you’re trying to tell.</li>
<li>Group or collapse less important data to simplify interpretation.</li>
<li>Whitespace is your friend</li>
</ul>
<p>Here’s an example of a visualization of COVID-19 deaths from <a href="https://www.theguardian.com/us-news/2022/mar/13/how-covid-shook-the-us-charts-graphs" target="_blank">The Guardian</a> that has limited visual clutter and strong hierarchy.</p>
<p><img src="img/DataInk_EX1.png" class="img-fluid"></p>
</section>
<section id="design-for-your-output" class="level3">
<h3 data-anchor-id="design-for-your-output">Design for your output</h3>
<p>Effective visualization isn’t one-size-fits-all. Always consider where and how your work will be seen. Tailor your design choices to the medium and the audience:</p>
<ul>
<li><p><em>Print vs digital</em>: Pick fonts, line weights, and colors that are clear at the specific resolution and/or paper size that you are designing for. What works on a low-resolution screen may not translate well to paper.</p></li>
<li><p><em>Presentations vs.&nbsp;reports</em>: Slides call for bold, minimal visuals with large text and fewer details. Reports allow for more complexity and written explanation.</p></li>
<li><p><em>Social media</em>: Prioritize clarity at small sizes. Expect compression and low resolution and keep text minimal and legible.</p></li>
<li><p><em>Audience expertise</em>: Technical audiences may appreciate complex charts and granular data. Broader or non-expert audiences often benefit from simpler visuals, clear labeling, and guiding annotations.</p></li>
</ul>
<p>If you design a chart to fit within a specific medium (e.g.&nbsp;mobile view on a screen), it’s recommended you redesign the chart if you want to have it in a different context (e.g.&nbsp;printed in a report). This is to prevent fonts being resized so they are no longer legible, graphics losing resolution and becoming fuzzy, or distorted if they are resized.</p>
</section>
<section id="brand-guidelines" class="level3">
<h3 data-anchor-id="brand-guidelines">Brand guidelines</h3>
<p>If you’re creating visualizations within an organization or for a specific campaign, it’s important to follow established brand guidelines.</p>
<p>This includes using approved typefaces, colors, and logos, and aligning your visuals with the tone and messaging of the broader content.</p>
<p>Maintaining visual consistency across all charts, graphics, and reports reinforces brand identity, leads to more cohesive products, and builds recognition with your audience.</p>
</section>
<section id="annotations" class="level3">
<h3 data-anchor-id="annotations">Annotations</h3>
<p>Great charts don’t always speak for themselves. Use clear titles, subtitles, and axis labels. Add callouts or annotations to highlight patterns or anomalies. You can guide the reader to your takeaway rather than leaving it to interpretation.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/MeaslesExample.png" class="img-fluid figure-img"></p>
<figcaption>Example of how simple text labels and titles can help tell an effective visual story (Source: Wall Street Journal 2015)</figcaption>
</figure>
</div>
</section>
<section id="choosing-charts-based-on-your-data" class="level3">
<h3 data-anchor-id="choosing-charts-based-on-your-data">Choosing charts based on your data</h3>
<p>Match the visualization to the type of data and the message you’re trying to convey. Here’s a quick overview of very common charts for different types of data:</p>
<p><img src="img/ChartPurpose.png" class="img-fluid"></p>
<p>Choosing the right chart type is essential to making your data clear, compelling, and truthful. While there’s no single “correct” choice for every scenario, understanding your data and communication goals will help you select a format that highlights the story you want to tell. Whether you’re comparing categories, showing trends over time, exploring distributions, or revealing relationships, each chart type has strengths and limitations.</p>
<p>For a deeper dive into chart selection, visit <a href="https://www.data-to-viz.com/" target="_blank">From Data to Viz</a>, a comprehensive, visual guide that helps you choose the most appropriate chart based on your data structure and communication goals.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>